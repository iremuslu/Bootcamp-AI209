<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Profil - Emotery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/profile.css" />
</head>
<body>

<div class="sidebar">
    <h4>Emotery</h4>
    <hr style="border-color: #444;">
    <a href="/dashboard">🏠 Ana Sayfa</a>
    <a href="/emotion-graph">📈 Duygu Grafiği</a>
    <a href="/profile">👤 Profilim</a>
    <a href="/logout">🚪 Çıkış Yap</a>
</div>

<div class="main">
    <div class="profile-header">
        <h3>👤 Profil Bilgileri</h3>
        <p><strong>Kullanıcı Adı:</strong> {{ username }}</p>
        <p><strong>Kayıt Tarihi:</strong> {{ created_at }}</p>
        <p><strong>Toplam Günlük:</strong> {{ total_entries }}</p>
        <p><strong>En Sık Hissedilen Duygu:</strong> {{ most_frequent_emotion }}</p>
    </div>

    <div class="stats-container">
        <div class="stat-box">
            <h5>📝 Günlük Sayısı</h5>
            <p>{{ total_entries }}</p>
        </div>
        <div class="stat-box">
            <h5>⏰ En Son Kayıt</h5>
            <p>{{ last_entry_time }}</p>
        </div>
        <div class="stat-box">
            <h5>📊 Ortalama Ruh Hali</h5>
            <p>{{ average_emotion }}</p>
        </div>
    </div>
<!-- 🏆 Rozetler -->
<div class="badge-section">
    <h5>🏆 Rozetler</h5>
    <div class="badge-list">
        {% if badges %}
            {% for badge in badges %}
            <div class="badge earned" title="{{ badge.description }}">
                <span class="badge-icon">{{ badge.icon }}</span>
                <div class="badge-name">{{ badge.name }}</div>
                <div class="badge-date">{{ badge.earned_at }}</div>
            </div>
            {% endfor %}
        {% else %}
            <p>Henüz rozet kazanmadınız.</p>
        {% endif %}
    </div>
</div>

    <div class="calendar-box">
        <div class="calendar-header">
            <a href="/profile?month={{ current_month - 1 if current_month > 1 else 12 }}&year={{ current_year - 1 if current_month == 1 else current_year }}"
            class="btn btn-sm btn-secondary">◀ Önceki</a>

            <h5>📅 Günlük Takvimi ({{ month_name }} {{ current_year }})</h5>

            <a href="/profile?month={{ current_month + 1 if current_month < 12 else 1 }}&year={{ current_year + 1 if current_month == 12 else current_year }}"
            class="btn btn-sm btn-secondary">Sonraki ▶</a>
        </div>

            <div class="calendar-grid">
                {% for day in days %}
                <div class="day-circle"
                    style="background-color: {{ day.entries[-1].color if day.entries else '#555' }};"
                    data-date="{{ day.number }} {{ month_name }} {{ current_year }}"
                    data-entries='{{ day.entries | tojson }}'>
                    {{ day.number }}
                </div>
        {% endfor %}
            </div>
    </div>

<!-- 🆕 Duygular Rehberi -->
<div class="emotion-guide-section">
    <h5>📌 Duygular Rehberi</h5>
    <p style="text-align:center; font-size: 16px; color: #ccc; margin-bottom: 15px;">
        Bu rehber, hissettiğin duyguların anlamlarını ve etkilerini anlamana yardımcı olur.
        Üzerine geldiğinde her duygunun kısa açıklamasını görebilirsin.
    </p>

    <div class="emotion-category negative">
        <strong>😞 Negatif Duygular</strong>
        {% for emotion, data in EMOTION_MAP.items() if data.score <= 6 %}
            <span style="background-color: {{ data.color }};"
                  title="{{ data.description }}"
                  data-color="{{ data.color }}"
                  data-bs-toggle="tooltip"
                  data-bs-placement="top">
                {{ data.emoji }} {{ emotion }}
            </span>
        {% endfor %}
    </div>

    <div class="emotion-category neutral">
        <strong>😐 Nötr Duygular</strong>
        {% for emotion, data in EMOTION_MAP.items() if 7 <= data.score <= 9 %}
            <span style="background-color: {{ data.color }};"
                  title="{{ data.description }}"
                  data-color="{{ data.color }}"
                  data-bs-toggle="tooltip"
                  data-bs-placement="top">
                {{ data.emoji }} {{ emotion }}
            </span>
        {% endfor %}
    </div>

    <div class="emotion-category positive">
        <strong>😊 Pozitif Duygular</strong>
        {% for emotion, data in EMOTION_MAP.items() if data.score >= 10 %}
            <span style="background-color: {{ data.color }};"
                  title="{{ data.description }}"
                  data-color="{{ data.color }}"
                  data-bs-toggle="tooltip"
                  data-bs-placement="top">
                {{ data.emoji }} {{ emotion }}
            </span>
        {% endfor %}
    </div>
</div>



    <a href="/dashboard" class="btn-dashboard">⬅ Anasayfa’ya Dön</a>
</div>

<!-- 📅 Gün Detay Modal -->
<div class="modal fade" id="dayModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content custom-modal">
      <div class="modal-header">
        <h5 class="modal-title">📅 Günlük Detayı</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="modalEntries"></div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.querySelectorAll(".day-circle").forEach(day => {
    day.addEventListener("click", function() {
        const date = this.dataset.date;
        const entries = JSON.parse(this.dataset.entries || "[]");
        const modalBody = document.getElementById("modalEntries");

        modalBody.innerHTML = `<p><strong>Tarih:</strong> ${date}</p><hr>`;

        if (entries.length === 0) {
            modalBody.innerHTML += "<p>Bu gün için kayıt bulunmuyor.</p>";
        } else {
            entries.forEach(entry => {
                modalBody.innerHTML += `
                    <div class="entry-box">
                        <p><strong>Duygu:</strong> ${entry.emoji} ${entry.emotion || 'Yok'}</p>
                        <p><strong>Not:</strong> ${entry.note || 'Not yok'}</p>
                        <a href="/all-entries?date=${entry.date}" class="btn btn-sm btn-info mt-1">Detay</a>
                    </div>
                    <hr>
                `;
            });
        }
        new bootstrap.Modal(document.getElementById("dayModal")).show();
    });
});

// 🔹 Tooltipleri başlat ve rengini duygunun rengine göre ayarla
document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
    new bootstrap.Tooltip(el);

    el.addEventListener('mouseenter', () => {
        const tooltipId = el.getAttribute('aria-describedby');
        const tooltipEl = document.getElementById(tooltipId);
        const color = el.getAttribute('data-color');

        if (tooltipEl && color) {
            tooltipEl.style.setProperty('--tooltip-bg', color);
        }
    });
});
</script>


</body>
</html>
