<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Dashboard - Emotery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/dashboard.css" />
</head>
<body>

<!-- ğŸŒ TOP NAVIGATION -->
<header class="top-nav">
  <div class="logo">
    <a href="/dashboard">
      <img src="/static/pics/logo.png" alt="Emotery Logo" class="logo-img">
      <span class="logo-text">Emotery</span>
    </a>
  </div>

  <div class="right-section">
    <!-- Tek profil butonu (yuvarlak) -->
    <div class="profile-dropdown">
      <button class="profile-btn" id="profileToggle">
        {{ username[0].upper() }}
      </button>
      <ul class="dropdown-menu" id="profileMenu">
        <li>
          <a href="/profile">ğŸ‘¤ Profil</a>
        </li>
        <li>
          <a class="logout" href="/logout">ğŸšª Ã‡Ä±kÄ±ÅŸ</a>
        </li>
      </ul>
    </div>
  </div>
</header>

<div class="dashboard-container">
  <!-- Ãœst KarÅŸÄ±lama KartÄ± -->
  <div class="welcome-card">
    <div>
      <h2>Merhaba {{ username }}! ğŸ‘‹</h2>
      <p>BugÃ¼n nasÄ±l hissediyorsunuz? DuygularÄ±nÄ±zÄ± keÅŸfetmeye hazÄ±r mÄ±sÄ±nÄ±z?</p>
    </div>
    <div class="today-date">
      <span class="label">BugÃ¼n</span>
      <span class="date" id="todayDate"></span>
    </div>
  </div>

  <!-- Orta KÄ±sÄ±m 3 Kart -->
  <div class="card-grid">
    <div class="card">
      <h3>âœï¸ GÃ¼nlÃ¼k Yaz</h3>
      <p>DuygularÄ±nÄ±zÄ± yazarak iÃ§ dÃ¼nyanÄ±zÄ± keÅŸfedin ve AI destekli analiz alÄ±n.</p>
      <a href="/journal">
          <button class="btn-primary">+ Yeni GÃ¼nlÃ¼k</button>
      </a>
    </div>

    <div class="card">
      <h3>ğŸ“Š Duygu Takibi</h3>
      <p>Zamanla duygu deÄŸiÅŸimlerinizi grafiklerle gÃ¶rselleÅŸtirin ve desenler keÅŸfedin.</p>
      <a href="/emotion-graph">
        <button class="btn-primary btn-green">ğŸ“ˆ GrafiÄŸi GÃ¶r</button>
      </a>
    </div>

    <div class="card">
      <h3>ğŸ‘¤ Profil & Ä°statistikler</h3>
      <p>KiÅŸisel geliÅŸim yolculuÄŸunuzu detaylÄ± istatistiklerle takip edin.</p>
      <a href="/profile">
        <button class="btn-primary btn-cyan">ğŸ‘¤ Profilim</button>
      </a>
    </div>
  </div>

<!-- Son GÃ¼nlÃ¼k KayÄ±tlarÄ± -->
<div class="logs-card">
  <div class="logs-header">
    <div>
      <span>ğŸ•’ Son GÃ¼nlÃ¼k KayÄ±tlarÄ±nÄ±z</span>
      <small class="text-muted ms-2">{{ recent_entries|length }} kayÄ±t</small>
    </div>
    <a href="/all-entries">
      <button class="btn-outline">TÃ¼m KayÄ±tlarÄ± GÃ¶r</button>
    </a>
  </div>

  {% set emotion_map = {
    "ÃœzgÃ¼n": {"emoji": "ğŸ˜¢", "color": "#a83232"},
    "Kederli": {"emoji": "ğŸ˜", "color": "#b84e3b"},
    "EndiÅŸeli": {"emoji": "ğŸ˜Ÿ", "color": "#c47442"},
    "YalnÄ±z": {"emoji": "ğŸ˜”", "color": "#cc9659"},
    "KararsÄ±z": {"emoji": "ğŸ˜•", "color": "#d1b25c"},
    "SÄ±kÄ±lmÄ±ÅŸ": {"emoji": "ğŸ˜’", "color": "#e2cf60"},
    "Yorgun": {"emoji": "ğŸ˜´", "color": "#b3d665"},
    "NÃ¶tr": {"emoji": "ğŸ˜", "color": "#81d676"},
    "Huzurlu": {"emoji": "ğŸ˜Œ", "color": "#4dc49f"},
    "Mutlu": {"emoji": "ğŸ˜Š", "color": "#45a7c8"},
    "HeyecanlÄ±": {"emoji": "ğŸ˜„", "color": "#5e7dd4"},
    "BunalmÄ±ÅŸ": {"emoji": "ğŸ˜«", "color": "#9c27b0"},
    "Mesafeli": {"emoji": "ğŸ˜¶", "color": "#607d8b"},
    "Ã‡aresiz": {"emoji": "ğŸ˜©", "color": "#795548"},
    "KÄ±rgÄ±n": {"emoji": "ğŸ˜”", "color": "#ff7043"},
    "SÄ±kÄ±ÅŸmÄ±ÅŸ": {"emoji": "ğŸ˜–", "color": "#880e4f"}
  } %}

  <div class="recent-entries-grid">
    {% if recent_entries %}
      {% for entry in recent_entries %}
        <div class="recent-entry-item">
          <span class="entry-badge" style="background-color: {{ emotion_map.get(entry.emotion, {'color': '#6b7280'}).color }};">
            {{ emotion_map.get(entry.emotion, {'emoji': 'â“'}).emoji }} {{ entry.emotion }}
          </span>
          <div class="entry-content">
            {{ entry.content[:80] }}{% if entry.content|length > 80 %}...{% endif %}
          </div>
          <div class="entry-date">{{ entry.date }}</div>
        </div>
      {% endfor %}
    {% else %}
      <div class="recent-entry-item" style="justify-content: center;">
        <p class="text-muted m-0">HenÃ¼z gÃ¼nlÃ¼k kaydÄ± yok.</p>
      </div>
    {% endif %}
  </div>
  </div>

  <!-- GÃ¼nlÃ¼k Motivasyon SÃ¶zleri -->
  <div class="motivational-section">
    <div class="motivational-card">
      <div class="motivational-header">
        <h4>ğŸ’« GÃ¼nÃ¼n Motivasyon SÃ¶zleri</h4>
        <p>Size ilham verecek Ã¶zel seÃ§ilmiÅŸ sÃ¶zler</p>
      </div>

      <div class="motivational-quotes" id="motivationalQuotes">
        <!-- Quotes will be loaded here by JavaScript -->
      </div>
    </div>
  </div>

</div>

<script>
  // Motivational quotes database
  const motivationalQuotes = [
    {
      text: "Hayattaki en bÃ¼yÃ¼k zaferler, hiÃ§ dÃ¼ÅŸmemekten deÄŸil, her dÃ¼ÅŸtÃ¼ÄŸÃ¼mÃ¼zde ayaÄŸa kalkmaktan gelir.",
      author: "Nelson Mandela",
      icon: "ğŸŒŸ"
    },
    {
      text: "Mutluluk hazÄ±r bir ÅŸey deÄŸildir. Kendi eylemlerinizden doÄŸar.",
      author: "Dalai Lama",
      icon: "ğŸ˜Š"
    },
    {
      text: "BugÃ¼n yapabileceÄŸin en iyi ÅŸey, dÃ¼nÃ¼n hatalarÄ±ndan ders Ã§Ä±karmak ve yarÄ±n iÃ§in umutlu olmaktÄ±r.",
      author: "Maya Angelou",
      icon: "ğŸŒ…"
    },
    {
      text: "Ä°Ã§ huzurunuz, dÄ±ÅŸ koÅŸullarÄ±nÄ±zdan daha Ã¶nemlidir.",
      author: "Epiktetos",
      icon: "ğŸ§˜â€â™€ï¸"
    },
    {
      text: "Her yeni gÃ¼n, yeni bir baÅŸlangÄ±Ã§ ve yeni umutlar getirir.",
      author: "Emily Dickinson",
      icon: "ğŸŒˆ"
    },
    {
      text: "DuygularÄ±nÄ±zÄ± kontrol edemezsiniz, ama onlara nasÄ±l tepki vereceÄŸinizi seÃ§ebilirsiniz.",
      author: "Viktor Frankl",
      icon: "ğŸ’ª"
    },
    {
      text: "Kendine karÅŸÄ± nazik ol. Sen de geliÅŸmeye devam eden bir insansÄ±n.",
      author: "Unknown",
      icon: "ğŸŒ±"
    },
    {
      text: "Bazen en bÃ¼yÃ¼k cesaret, yarÄ±n tekrar denemeye karar vermektir.",
      author: "Unknown",
      icon: "ğŸ¦‹"
    },
    {
      text: "Minnettar bir kalp, mutluluÄŸun anahtarÄ±dÄ±r.",
      author: "Unknown",
      icon: "ğŸ™"
    },
    {
      text: "Her dÃ¼ÅŸÃ¼nceniz, bugÃ¼nÃ¼nÃ¼zÃ¼ ÅŸekillendirir. Pozitif dÃ¼ÅŸÃ¼nmeyi seÃ§in.",
      author: "Unknown",
      icon: "âœ¨"
    },
    {
      text: "ZorluklarÄ±nÄ±z, gÃ¼cÃ¼nÃ¼zÃ¼ keÅŸfetmeniz iÃ§in fÄ±rsatlardÄ±r.",
      author: "Unknown",
      icon: "ğŸ’"
    },
    {
      text: "KÃ¼Ã§Ã¼k adÄ±mlar da sizi hedefinize gÃ¶tÃ¼rÃ¼r. SabÄ±rlÄ± olun.",
      author: "Lao Tzu",
      icon: "ğŸš¶â€â™€ï¸"
    }
  ];

  function getRandomQuotes(count = 3) {
    const shuffled = [...motivationalQuotes].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
  }

  function displayMotivationalQuotes() {
    const quotesContainer = document.getElementById('motivationalQuotes');
    const dailyQuotes = getRandomQuotes(3);

    quotesContainer.innerHTML = dailyQuotes.map(quote => `
      <div class="quote-item">
        <span class="quote-icon">${quote.icon}</span>
        <div class="quote-text">${quote.text}</div>
        <div class="quote-author">â€” ${quote.author}</div>
      </div>
    `).join('');
  }

  document.addEventListener("DOMContentLoaded", () => {
    const todayElement = document.getElementById("todayDate");

    const today = new Date();
    const options = { day: 'numeric', month: 'long', year: 'numeric' };

    todayElement.textContent = today.toLocaleDateString("tr-TR", options);

    // Load motivational quotes
    displayMotivationalQuotes();
  });

  // Dropdown menÃ¼sÃ¼ toggle
  document.getElementById("profileToggle").addEventListener("click", () => {
    const menu = document.getElementById("profileMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  });

  // MenÃ¼ dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapat
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".profile-dropdown")) {
      document.getElementById("profileMenu").style.display = "none";
    }
  });

  // Quick Actions Functions
  async function openQuickNote() {
    const note = prompt("HÄ±zlÄ± notunuzu yazÄ±n:");
    if (note && note.trim()) {
      try {
        const response = await fetch('/api/quick-note', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            content: note,
            emotion: 'NÃ¶tr'
          })
        });

        if (response.ok) {
          alert('Not baÅŸarÄ±yla kaydedildi!');
          location.reload(); // Refresh to show new entry
        } else {
          alert('Not kaydedilirken hata oluÅŸtu.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('BaÄŸlantÄ± hatasÄ± oluÅŸtu.');
      }
    }
  }

  async function setDailyGoal() {
    const emotions = ['Mutlu', 'Huzurlu', 'Enerjik', 'OdaklanmÄ±ÅŸ', 'Minnettar', 'Sakin'];
    const selectedEmotion = prompt(`BugÃ¼nkÃ¼ hedef duygunuzu seÃ§in:\n${emotions.join(', ')}`);

    if (selectedEmotion && emotions.includes(selectedEmotion)) {
      try {
        const response = await fetch('/api/daily-goal', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            target_emotion: selectedEmotion,
            notes: `BugÃ¼nkÃ¼ hedef: ${selectedEmotion} hissetmek`
          })
        });

        if (response.ok) {
          alert(`GÃ¼nlÃ¼k hedefiniz "${selectedEmotion}" olarak belirlendi!`);
        } else {
          alert('Hedef belirlenirken hata oluÅŸtu.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('BaÄŸlantÄ± hatasÄ± oluÅŸtu.');
      }
    }
  }

  async function startBreathingExercise() {
    if (confirm('5 dakikalÄ±k nefes egzersizi baÅŸlatÄ±lsÄ±n mÄ±?')) {
      // Simple breathing exercise simulation
      let countdown = 5 * 60; // 5 minutes in seconds
      const interval = setInterval(() => {
        countdown--;
        if (countdown <= 0) {
          clearInterval(interval);
          completeBreathingSession();
        }
      }, 1000);

      alert('Nefes egzersizi baÅŸladÄ±! 5 dakika boyunca derin nefes alÄ±p verin.');
    }
  }

  async function completeBreathingSession() {
    try {
      const response = await fetch('/api/breathing-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          duration: 5
        })
      });

      if (response.ok) {
        alert('Tebrikler! Nefes egzersizini tamamladÄ±nÄ±z. ğŸ§˜â€â™€ï¸');
      }
    } catch (error) {
      console.error('Error logging breathing session:', error);
    }
  }
</script>

</body>
</html>