<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>GÃ¼nlÃ¼k Yaz - Emotery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/css/styles.css" />
</head>
<body>
<div class="journal-container">
    <!-- Header -->
    <div class="journal-header">
        <div class="back-button" onclick="window.location.href='/dashboard?user_id={{ user_id }}&username={{ username }}'">
            â†
        </div>
        <img src="/static/pics/logoAI.png" alt="Emotery Logo" class="journal-logo">
        <div></div> <!-- Spacer for flexbox -->
    </div>

    <div class="journal-card">
        <h2 class="journal-title">Merhaba {{ username }}! ğŸ‘‹</h2>
        <p class="journal-subtitle">BugÃ¼n neler hissettiniz? DuygularÄ±nÄ±zÄ± bizimle paylaÅŸÄ±n</p>

        <!-- Mood Selection -->
        <div class="mood-tabs">
            <button class="mood-tab active" data-tab="profile">ğŸ‘¤ Profilim</button>
            <button class="mood-tab" data-tab="emotion">ğŸ“Š Duygu GrafiÄŸini GÃ¶r</button>
        </div>

        <!-- Journal Form -->
        <form id="diaryForm" action="/diary" method="post">
            <input type="hidden" name="user_id" value="{{ user_id }}">

            <div class="journal-input-section">
                <label class="journal-label">BugÃ¼n nasÄ±lsÄ±n?</label>
                <textarea
                    name="content"
                    class="journal-textarea"
                    placeholder="BugÃ¼n nasÄ±l hissediyorsun? DuygularÄ±nÄ±, dÃ¼ÅŸÃ¼ncelerini veya yaÅŸadÄ±ÄŸÄ±n deneyimleri burada paylaÅŸ..."
                    required
                ></textarea>
            </div>

            <button type="submit" class="btn-save-journal">
                ğŸ“ GÃ¼nlÃ¼ÄŸÃ¼ Kaydet
            </button>
        </form>

        <!-- Voice Recording Button -->
        <button id="micButton" class="btn-voice-record">
            ğŸ¤ Sesli GÃ¼nlÃ¼k BaÅŸlat
        </button>

        <!-- Mood Analysis Result -->
        <div id="result" class="analysis-result"></div>

        <!-- Mood Tips Section -->
        <div class="mood-tips" id="moodTips">
            <div class="tip-header">GÃ¼nlÃ¼ÄŸÃ¼nÃ¼z kaydedildi</div>
            <div class="tip-content">
                <div class="tip-item">
                    <span class="tip-emoji">ğŸŸ¢</span>
                    <span class="tip-label">Duygu:</span>
                    <span class="tip-text">YÃ¼kselmiÅŸ</span>
                </div>
                <div class="tip-item">
                    <span class="tip-emoji">âš ï¸</span>
                    <span class="tip-label">Yorum:</span>
                    <span class="tip-text">Bu hissin ne kadar aÄŸÄ±r ve yÄ±kÄ±cÄ± olabileceÄŸini anlÄ±yorum. Bazen Ã¶mrÃ¼mÃ¼zde yÄ±k gerÃ§ekten aÄŸÄ±r geliÅŸebilir.</span>
                </div>
                <div class="tip-item">
                    <span class="tip-emoji">âœ…</span>
                    <span class="tip-label">Ã–neriler:</span>
                    <div class="tip-suggestions">
                        Kendine 15-20 dakikalÄ±k kÄ±sa bir mola izin ver. Bu sÃ¼re sadece uzanabilir, gÃ¶zlerini kapatabilir veya sessizce oturabilirsiin. Seni rahatlatacak bir ÅŸey iÃ§in papatyali Ã§ayÄ± gibi bitkÃ® Ã§ayÄ±nÄ± veya sÄ±cak bir bardak tilt su, nem bereketinin hep de zihimi sakinleÅŸtirmeye yardÄ±mcÄ± olabilir. Telefonunu veya bilgisayarÄ±nÄ± bu sÃ¼reliÄŸine uzaÅŸÄ±na koy. Zihimi dinlendirmek iÃ§in teknolojiye kÄ±sa bir ara vermek bile fark yaratabilir.
                    </div>
                </div>
            </div>
        </div>

        <!-- Start Journal Button -->
        <button class="btn-start-journal" id="startJournalBtn">
            ğŸµ Sesli GÃ¼nlÃ¼k BaÅŸlat
        </button>
    </div>
</div>

<script>
// Tab switching functionality
document.querySelectorAll('.mood-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.mood-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
    });
});

// Form submission with AJAX
document.getElementById('diaryForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const resultDiv = document.getElementById('result');
    const moodTips = document.getElementById('moodTips');

    resultDiv.innerHTML = '';

    try {
        const response = await fetch(form.action, {
            method: form.method,
            body: formData
        });

        if (!response.ok) throw new Error('Sunucu hatasÄ±!');

        const data = await response.json();

        // Show success message
        resultDiv.innerHTML = `
            <div class="success-message">
                <div class="success-icon">âœ…</div>
                <div class="success-text">GÃ¼nlÃ¼ÄŸÃ¼nÃ¼z baÅŸarÄ±yla kaydedildi!</div>
            </div>
        `;

        // Update mood tips with real data
        const tipContent = moodTips.querySelector('.tip-content');
        tipContent.innerHTML = `
            <div class="tip-item">
                <span class="tip-emoji">ğŸŸ¢</span>
                <span class="tip-label">Duygu:</span>
                <span class="tip-text">${data.sentiment}</span>
            </div>
            <div class="tip-item">
                <span class="tip-emoji">ğŸ’­</span>
                <span class="tip-label">Yorum:</span>
                <span class="tip-text">${data.comment}</span>
            </div>
            ${data.suggestions ? `
            <div class="tip-item">
                <span class="tip-emoji">âœ…</span>
                <span class="tip-label">Ã–neriler:</span>
                <div class="tip-suggestions">${data.suggestions}</div>
            </div>
            ` : ''}
        `;

        moodTips.style.display = 'block';
        form.reset();

    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error-message">
                <div class="error-icon">âŒ</div>
                <div class="error-text">Bir hata oluÅŸtu: ${error.message}</div>
            </div>
        `;
    }
});

// Voice recording functionality
const micButton = document.getElementById("micButton");
const contentInput = document.querySelector("textarea[name='content']");
let recognition;
if ("webkitSpeechRecognition" in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.lang = "tr-TR";

    recognition.onresult = function (event) {
        const transcript = event.results[0][0].transcript;
        contentInput.value += transcript + " ";
    };

    recognition.onerror = function (event) {
        alert("ğŸ¤ Ses algÄ±lanamadÄ±: " + event.error);
    };

    recognition.onend = function () {
        micButton.textContent = "ğŸ¤ Sesli GÃ¼nlÃ¼k BaÅŸlat";
        micButton.classList.remove('recording');
    };
} else {
    micButton.style.display = 'none';
}

micButton.addEventListener("click", () => {
    if (recognition) {
        recognition.start();
        micButton.textContent = "ğŸ›‘ Dinleniyor...";
        micButton.classList.add('recording');
    }
});

// Initially hide mood tips
document.getElementById('moodTips').style.display = 'none';
</script>
</body>
</html>